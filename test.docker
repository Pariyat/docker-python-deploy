FROM docker-python-deploy-run

ENV WHEELHOUSE=/wheelhouse
ENV PIP_WHEEL_DIR=/wheelhouse
ENV PIP_FIND_LINKS=/wheelhouse

ADD . /app_files
ADD .python/py2.7 /usr/python/py2.7
ADD .python/py3.4 /usr/python/py3.4
ADD wheelhouse /wheelhouse
RUN . /appenv/bin/activate; \
    pip install --no-index -f wheelhouse -r /app_files/requirements.txt \
    -r /app_files/dev-requirements.txt

RUN virtualenv -p /usr/python/py2.7/bin/python2.7 /py27
RUN virtualenv -p /usr/python/py3.4/python3.4 /py34

ENTRYPOINT . /appenv/bin/activate; \
    cd /app_files && \
    tox /app_files
